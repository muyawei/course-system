<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è¯¾ç¨‹ç³»ç»Ÿ</title>
    <script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4cc9f0;
            --success-color: #4ade80;
            --warning-color: #facc15;
            --danger-color: #f87171;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(120deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--border-radius);
            color: white;
            box-shadow: var(--box-shadow);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            margin-bottom: 25px;
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.2);
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            text-align: center;
        }

        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-success {
            background: var(--success-color);
        }

        .btn-success:hover {
            background: #22c55e;
        }

        .btn-warning {
            background: var(--warning-color);
            color: var(--dark-color);
        }

        .btn-warning:hover {
            background: #eab308;
        }

        .btn-danger {
            background: var(--danger-color);
        }

        .btn-danger:hover {
            background: #ef4444;
        }

        .btn-secondary {
            background: #64748b;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .file-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: #f8fafc;
        }

        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: #f1f5f9;
        }

        .file-upload-area i {
            font-size: 3rem;
            color: #94a3b8;
            margin-bottom: 15px;
        }

        .file-list {
            margin-top: 15px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f1f5f9;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--primary-color);
        }

        .loading::after {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(67, 97, 238, 0.3);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .alert-success {
            background: #dcfce7;
            border: 1px solid #bbf7d0;
            color: #166534;
        }

        .alert-error {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        .preview-container {
            background: #f8fafc;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e2e8f0;
        }

        .material-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .material-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f5f9;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: #e2e8f0;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .course-option {
            padding: 15px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            cursor: pointer;
            margin-bottom: 15px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .course-option:hover {
            border-color: var(--primary-color);
            background: #f8fafc;
        }

        .course-option.selected {
            border-color: var(--primary-color);
            background: #eff6ff;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .course-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #e0f2fe;
            color: var(--primary-color);
        }

        .course-info h3 {
            margin-bottom: 5px;
        }

        .course-info p {
            color: #64748b;
            font-size: 0.9rem;
        }

        .uaro-option {
            background: #fff7ed;
            color: #ea580c;
        }

        .uaro-option .course-icon {
            background: #ffedd5;
            color: #ea580c;
        }

        .kiro-option {
            background: #f0f9ff;
            color: #0284c7;
        }

        .kiro-option .course-icon {
            background: #e0f2fe;
            color: #0284c7;
        }

        .microcontroller-option {
            background: #f0fdf4;
            color: #16a34a;
        }

        .microcontroller-option .course-icon {
            background: #dcfce7;
            color: #16a34a;
        }

        .python-option {
            background: #fff3e0;
            color: #f39c12;
        }

        .python-option .course-icon {
            background: #ffe0b2;
            color: #f39c12;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ™ºèƒ½è¯¾ç¨‹ç³»ç»Ÿ</h1>
            <p class="subtitle">AIé©±åŠ¨çš„å°‘å„¿ç¼–ç¨‹è¯¾ç¨‹ç”Ÿæˆå¹³å°</p>
        </header>

        <!-- è¯¾ç¨‹ç±»å‹é€‰æ‹© -->
        <div class="card">
            <h2 class="card-title">é€‰æ‹©è¯¾ç¨‹ç±»å‹</h2>
            <div class="course-options">
                <div class="course-option uaro-option" onclick="selectCourseType('uaro')">
                    <div class="course-icon">ğŸ§±</div>
                    <div class="course-info">
                        <h3>Uaroè¯¾ç¨‹ï¼ˆç¼–ç ç§¯æœ¨ï¼‰</h3>
                        <p>é€‚åˆä¸­ç­åˆ°å¤§ç­ä¸Šï¼Œé€šè¿‡ç§¯æœ¨å¼ç¼–ç¨‹åŸ¹å…»é€»è¾‘æ€ç»´</p>
                    </div>
                </div>
                
                <div class="course-option kiro-option" onclick="selectCourseType('kiro')">
                    <div class="course-icon">ğŸƒ</div>
                    <div class="course-info">
                        <h3>Kiroè¯¾ç¨‹ï¼ˆå¡ç‰‡å¼ç¼–ç¨‹ï¼‰</h3>
                        <p>é€‚åˆå¤§ç­åˆ°ä¸€å¹´çº§ï¼Œé€šè¿‡å¡ç‰‡æ¸¸æˆå­¦ä¹ ç¼–ç¨‹æ¦‚å¿µ</p>
                    </div>
                </div>
                
                <div class="course-option microcontroller-option" onclick="selectCourseType('microcontroller')">
                    <div class="course-icon">âš™ï¸</div>
                    <div class="course-info">
                        <h3>å•ç‰‡æœºè¯¾ç¨‹</h3>
                        <p>é€‚åˆ2-4å¹´çº§ï¼Œç»“åˆç¡¬ä»¶æ­å»ºå’ŒScratchç¼–ç¨‹</p>
                    </div>
                </div>
                
                <div class="course-option python-option" onclick="selectCourseType('python')">
                    <div class="course-icon">ğŸ</div>
                    <div class="course-info">
                        <h3>Pythonè¯¾ç¨‹</h3>
                        <p>é€‚åˆ4å¹´çº§åˆ°åˆäºŒï¼ŒåŸ¹å…»ç¼–ç¨‹æ€ç»´å’Œè§£å†³å®é™…é—®é¢˜èƒ½åŠ›</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸Šä¼ ææ–™å’Œç”Ÿæˆè¯¾ç¨‹ç›®æ ‡ -->
        <div class="card">
            <h2 class="card-title">ä¸Šä¼ è¯¾ç¨‹ææ–™</h2>
            <div class="form-group">
                <label for="course-theme">è¯¾ç¨‹ä¸»é¢˜ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                <input type="text" id="course-theme" placeholder="è¯·è¾“å…¥è¯¾ç¨‹ä¸»é¢˜">
            </div>
            
            <div class="form-group">
                <label>ä¸Šä¼ è¯¾ç¨‹ææ–™ï¼š</label>
                <div class="file-upload-area" onclick="document.getElementById('file-input').click()">
                    <i>ğŸ“</i>
                    <p>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                    <p style="font-size: 0.9rem; color: #64748b;">æ”¯æŒ PPTã€PPTXã€PDFã€DOCã€DOCXã€TXT æ ¼å¼</p>
                    <input type="file" id="file-input" multiple style="display: none;" accept=".ppt,.pptx,.pdf,.doc,.docx,.txt">
                </div>
                <div class="file-list" id="file-list"></div>
            </div>
            
            <button class="btn" onclick="generateCourseGoals()">ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡</button>
            
            <div class="loading" id="goals-loading" style="display: none;">AIæ­£åœ¨ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡...</div>
            <div id="goals-result"></div>
        </div>

        <!-- ç”Ÿæˆè¯¾ç¨‹ææ–™ -->
        <div class="card" id="materials-section" style="display: none;">
            <h2 class="card-title">ç”Ÿæˆè¯¾ç¨‹ææ–™</h2>
            <button class="btn btn-success" onclick="generateCourseMaterials()">ç”Ÿæˆå…¨å¥—è¯¾ç¨‹ææ–™</button>
            
            <div class="loading" id="materials-loading" style="display: none;">AIæ­£åœ¨ç”Ÿæˆè¯¾ç¨‹ææ–™...</div>
            <div id="materials-result"></div>
        </div>

        <!-- ææ–™é¢„è§ˆå’Œå¯¼å‡º -->
        <div class="card" id="materials-preview" style="display: none;">
            <h2 class="card-title">ææ–™é¢„è§ˆä¸å¯¼å‡º</h2>
            <div class="btn-group">
                <button class="btn btn-success" onclick="saveAllMaterials()">ä¿å­˜æ‰€æœ‰ææ–™</button>
                <button class="btn btn-warning" onclick="exportAllMaterials()">å¯¼å‡ºæ‰€æœ‰ææ–™</button>
                <button class="btn" onclick="saveAndExportAllMaterials()">ä¿å­˜å¹¶å¯¼å‡ºæ‰€æœ‰ææ–™</button>
            </div>
            
            <div id="material-preview-cards"></div>
        </div>

        <footer>
            <p>æ™ºèƒ½è¯¾ç¨‹ç³»ç»Ÿ Â© 2025 - ä¸“ä¸ºå°‘å„¿ç¼–ç¨‹æ•™è‚²æœºæ„è®¾è®¡</p>
        </footer>
    </div>

    <script>
        // é…ç½®å‚æ•°
        const CONFIG = {
            API_KEY: 'sk-a088d94696eb49438b25205761a0744f', // DeepSeek APIå¯†é’¥
            API_URL: 'https://api.deepseek.com/chat/completions',
            MODEL: 'deepseek-chat',
            MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
            ALLOWED_TYPES: [
                'application/vnd.ms-powerpoint',
                'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'text/plain'
            ]
        };

        // Kiroè¯¾ç¨‹é…ç½®
        const KIRO_CONFIG = {
            COURSE_NAME: "Kiroè¯¾ç¨‹ï¼ˆå¡ç‰‡å¼ç¼–ç¨‹ï¼‰",
            AGE_GROUP: "å¤§ç­åˆ°1å¹´çº§",
            PROGRAMMING_TYPE: "å¡ç‰‡å¼ç¼–ç¨‹",
            BUILDING_TYPE: "å°é¢—ç²’é“†é’‰ç‰©ç†æ­å»º",
            CORE_LOOPS: [
                "è¯¾å‰PPTå‡†å¤‡",
                "è®¾è®¡è¯¾æ ‡",
                "ç”Ÿæˆå®¶é•¿å›¾ç‰‡",
                "è®¾è®¡æ¿ä¹¦",
                "ç”Ÿæˆè¯¾åä½œä¸š",
                "ç”Ÿæˆè¯¾ååé¦ˆ",
                "ç”Ÿæˆäº’åŠ¨æ¸¸æˆ",
                "ç”Ÿæˆé€»è¾‘/æ•°è¯­ç»ƒä¹ "
            ]
        };
        
        // å•ç‰‡æœºè¯¾ç¨‹é…ç½®
        const MICROCONTROLLER_CONFIG = {
            COURSE_NAME: "å•ç‰‡æœºè¯¾ç¨‹ï¼ˆ2-4å¹´çº§ï¼‰",
            AGE_GROUP: "2-4å¹´çº§",
            PROGRAMMING_TYPE: "Scratchç¼–ç¨‹",
            BUILDING_TYPE: "åŸºç¡€æ­å»ºé…åˆä¼ æ„Ÿå™¨æ",
            CORE_LOOPS: [
                "è¯¾å ‚å†…å®¹",      // è¯¾ç¨‹é¢„å‘Šï¼Œå›¾ç‰‡å½¢å¼
                "è¯¾å ‚æ¿ä¹¦",      // è€å¸ˆå‚è€ƒï¼Œå›¾ç‰‡å½¢å¼
                "è¯¾åä½œä¸š",      // å·©å›ºç»ƒä¹ ï¼ŒWordå½¢å¼
                "è¯¾ååé¦ˆ",      // å®¶é•¿åé¦ˆï¼ŒWordå½¢å¼
                "è¯¾åæ‰©å±•",      // æ•°å­¦æ€ç»´/ç§‘å­¦å®éªŒï¼ŒWordå½¢å¼
                "ç§‘å­¦å®éªŒ"       // æ¸¸æˆæˆ–å°å®éªŒï¼ŒWordå½¢å¼
            ]
        };
        
        // Pythonè¯¾ç¨‹é…ç½®
        const PYTHON_CONFIG = {
            COURSE_NAME: "Pythonè¯¾ç¨‹ï¼ˆ4å¹´çº§åˆ°åˆäºŒï¼‰",
            AGE_GROUP: "4å¹´çº§åˆ°åˆäºŒ",
            PROGRAMMING_TYPE: "Pythonç¼–ç¨‹",
            BUILDING_TYPE: "æ–‡æœ¬ç¼–ç¨‹",
            CORE_LOOPS: [
                "è¯¾å ‚å†…å®¹",      // è¯¾ç¨‹é¢„å‘Šï¼Œå›¾ç‰‡å½¢å¼
                "è¯¾å ‚æ¿ä¹¦",      // è€å¸ˆå‚è€ƒï¼Œå›¾ç‰‡å½¢å¼
                "è¯¾åä½œä¸š",      // å·©å›ºç»ƒä¹ ï¼ŒWordå½¢å¼
                "è¯¾ååé¦ˆ",      // å®¶é•¿åé¦ˆï¼ŒWordå½¢å¼
                "è¯¾åæ‰©å±•"       // ç¼–ç¨‹ç§‘æ™®ï¼ŒWordå½¢å¼
            ]
        };
        
        // å…¨å±€å˜é‡
        let uploadedFiles = [];
        let courseGoals = "";
        let courseMaterials = {};
        let editors = {};
        let currentCourseType = "uaro"; // é»˜è®¤ä¸ºuaroè¯¾ç¨‹

        // é€‰æ‹©è¯¾ç¨‹ç±»å‹
        function selectCourseType(courseType) {
            currentCourseType = courseType;
            
            // æ›´æ–°UI
            document.querySelectorAll('.course-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            if (courseType === 'kiro') {
                document.querySelector('.kiro-option').classList.add('selected');
            } else if (courseType === 'microcontroller') {
                document.querySelector('.microcontroller-option').classList.add('selected');
            } else if (courseType === 'python') {
                document.querySelector('.python-option').classList.add('selected');
            } else {
                document.querySelector('.uaro-option').classList.add('selected');
            }
        }

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccess(message) {
            // åˆ›å»ºæˆåŠŸæ¶ˆæ¯å…ƒç´ 
            const successDiv = document.createElement('div');
            successDiv.className = 'alert alert-success';
            successDiv.textContent = message;
            successDiv.style.position = 'fixed';
            successDiv.style.top = '20px';
            successDiv.style.right = '20px';
            successDiv.style.zIndex = '1000';
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(successDiv);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.parentNode.removeChild(successDiv);
                }
            }, 3000);
        }

        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function showError(message) {
            // åˆ›å»ºé”™è¯¯æ¶ˆæ¯å…ƒç´ 
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-error';
            errorDiv.textContent = message;
            errorDiv.style.position = 'fixed';
            errorDiv.style.top = '20px';
            errorDiv.style.right = '20px';
            errorDiv.style.zIndex = '1000';
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(errorDiv);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 3000);
        }

        // ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡
        async function generateCourseGoals() {
            const loading = document.getElementById('goals-loading');
            const resultDiv = document.getElementById('goals-result');
            const courseTheme = document.getElementById('course-theme').value.trim();
            
            if (uploadedFiles.length === 0 && !courseTheme) {
                showError("è¯·å…ˆä¸Šä¼ è¯¾ç¨‹ææ–™æˆ–è¾“å…¥è¯¾ç¨‹ä¸»é¢˜");
                return;
            }

            try {
                loading.style.display = 'block';
                resultDiv.innerHTML = '';

                // æ„å»ºæç¤ºè¯
                let prompt = "";
                
                // æ ¹æ®è¯¾ç¨‹ç±»å‹è°ƒæ•´æç¤ºè¯
                if (currentCourseType === 'kiro') {
                    prompt += "æ‚¨æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºKiroè¯¾ç¨‹ï¼ˆå¡ç‰‡å¼ç¼–ç¨‹ï¼‰ï¼Œé€‚åˆå¤§ç­åˆ°ä¸€å¹´çº§çš„å­©å­ã€‚";
                } else if (currentCourseType === 'microcontroller') {
                    prompt += "æ‚¨æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºå•ç‰‡æœºè¯¾ç¨‹ï¼ˆ2-4å¹´çº§ï¼‰ï¼Œç»“åˆç¡¬ä»¶æ­å»ºå’ŒScratchç¼–ç¨‹ã€‚";
                } else if (currentCourseType === 'python') {
                    prompt += "æ‚¨æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºPythonè¯¾ç¨‹ï¼ˆ4å¹´çº§åˆ°åˆäºŒï¼‰ï¼Œæ³¨é‡åŸ¹å…»å­¦ç”Ÿçš„ç¼–ç¨‹æ€ç»´å’Œè§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›ã€‚";
                } else {
                    prompt += "æ‚¨æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºUaroè¯¾ç¨‹ï¼ˆç¼–ç ç§¯æœ¨ï¼‰ï¼Œé€‚åˆä¸­ç­åˆ°å¤§ç­çš„å­©å­ã€‚";
                }
                
                prompt += "\n\nè¯·æ ¹æ®ä»¥ä¸‹å†…å®¹ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡ï¼š\n";
                
                if (courseTheme) {
                    prompt += `è¯¾ç¨‹ä¸»é¢˜ï¼š${courseTheme}\n`;
                }
                
                if (uploadedFiles.length > 0) {
                    prompt += "ä¸Šä¼ çš„è¯¾ç¨‹ææ–™ï¼š\n";
                    uploadedFiles.forEach((file, index) => {
                        prompt += `${index + 1}. ${file.name}\n`;
                    });
                }
                
                prompt += "\nè¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡ï¼š\n";
                prompt += "1. è¯¾ç¨‹ä¸»é¢˜\n";
                prompt += "2. è¯¾ç¨‹ç›®æ ‡ï¼ˆçŸ¥è¯†ã€æŠ€èƒ½ã€æƒ…æ„Ÿï¼‰\n";
                prompt += "3. è¯¾ç¨‹é‡éš¾ç‚¹\n";
                prompt += "4. è¯¾ç¨‹æ€æ”¿å…ƒç´ \n";
                
                // è°ƒç”¨AI API
                const response = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${CONFIG.API_KEY}`,
                        'Content-Type': 'application/json',
                        'X-DashScope-SSE': 'disable'  // ç¦ç”¨SSEä»¥é¿å…è·¨åŸŸé—®é¢˜
                    },
                    body: JSON.stringify({
                        model: CONFIG.MODEL,
                        messages: [
                            {
                                role: "system",
                                content: "ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºè®¾è®¡é«˜è´¨é‡çš„è¯¾ç¨‹å†…å®¹ã€‚"
                            },
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                const goals = data.choices[0].message.content;
                
                // æ˜¾ç¤ºç»“æœ
                resultDiv.innerHTML = `
                    <div class="preview-container">
                        <pre style="white-space: pre-wrap; word-wrap: break-word;">${goals}</pre>
                        <div class="input-group" style="margin-top: 1rem;">
                            <button class="btn btn-success" onclick="editCourseGoals()" style="color: white;">ç¼–è¾‘è¯¾ç¨‹ç›®æ ‡</button>
                            <button class="btn btn-secondary" onclick="openGoalsRegenerateDialog()" style="color: white; margin-left: 10px;">é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡</button>
                        </div>
                        <!-- é‡æ–°ç”Ÿæˆå¯¹è¯æ¡† -->
                        <div id="goals-regenerate-dialog" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9;">
                            <h4>é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡</h4>
                            <div id="goals-chat-history" style="max-height: 200px; overflow-y: auto; margin-bottom: 10px; padding: 10px; background: white; border-radius: 4px; border: 1px solid #eee;">
                                <!-- å¯¹è¯å†å²å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                            <div style="display: flex;">
                                <input type="text" id="goals-chat-input" placeholder="è¾“å…¥æ‚¨çš„ä¿®æ”¹è¦æ±‚..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <button class="btn btn-secondary" onclick="sendGoalsChatMessage()" style="color: white;">å‘é€</button>
                                <button class="btn btn-secondary" onclick="closeGoalsRegenerateDialog()" style="color: white; margin-left: 10px;">å…³é—­</button>
                            </div>
                            <div class="loading" id="goals-regenerate-loading" style="display: none; margin-top: 10px;">AIæ­£åœ¨é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡...</div>
                        </div>
                    </div>
                `;
                
                courseGoals = goals;
            } catch (error) {
                console.error("ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡å¤±è´¥:", error);
                showError(`ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡å¤±è´¥: ${error.message}`);
            } finally {
                loading.style.display = 'none';
            }
        }

        // æ‰“å¼€è¯¾ç¨‹ç›®æ ‡é‡æ–°ç”Ÿæˆå¯¹è¯æ¡†
        function openGoalsRegenerateDialog() {
            const dialog = document.getElementById('goals-regenerate-dialog');
            dialog.style.display = 'block';
            
            // åˆå§‹åŒ–å¯¹è¯å†å²
            const chatHistory = document.getElementById('goals-chat-history');
            chatHistory.innerHTML = `
                <div style="margin-bottom: 10px; padding: 8px; background: #e3f2fd; border-radius: 4px;">
                    <strong>ç³»ç»Ÿ:</strong> æ‚¨å¯ä»¥å‘Šè¯‰æˆ‘æ‚¨å¯¹è¯¾ç¨‹ç›®æ ‡çš„å…·ä½“è¦æ±‚ï¼Œæˆ‘ä¼šæ ¹æ®æ‚¨çš„è¦æ±‚é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡ã€‚
                </div>
            `;
        }

        // å…³é—­è¯¾ç¨‹ç›®æ ‡é‡æ–°ç”Ÿæˆå¯¹è¯æ¡†
        function closeGoalsRegenerateDialog() {
            const dialog = document.getElementById('goals-regenerate-dialog');
            dialog.style.display = 'none';
        }

        // å‘é€è¯¾ç¨‹ç›®æ ‡èŠå¤©æ¶ˆæ¯
        async function sendGoalsChatMessage() {
            const input = document.getElementById('goals-chat-input');
            const message = input.value.trim();
            
            if (!message) {
                showError("è¯·è¾“å…¥æ‚¨çš„ä¿®æ”¹è¦æ±‚");
                return;
            }
            
            const chatHistory = document.getElementById('goals-chat-history');
            const loading = document.getElementById('goals-regenerate-loading');
            
            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            chatHistory.innerHTML += `
                <div style="margin-bottom: 10px; padding: 8px; background: #f0f0f0; border-radius: 4px;">
                    <strong>æ‚¨:</strong> ${message}
                </div>
            `;
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            input.value = '';
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loading.style.display = 'block';
            chatHistory.scrollTop = chatHistory.scrollHeight;
            
            try {
                // æ„å»ºæç¤ºè¯
                let prompt = `æ‚¨æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹è¦æ±‚é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡ï¼š

å½“å‰è¯¾ç¨‹ç›®æ ‡ï¼š
${courseGoals}

ç”¨æˆ·çš„å…·ä½“è¦æ±‚ï¼š
${message}

è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡ï¼š
1. è¯¾ç¨‹ä¸»é¢˜
2. è¯¾ç¨‹ç›®æ ‡ï¼ˆçŸ¥è¯†ã€æŠ€èƒ½ã€æƒ…æ„Ÿï¼‰
3. è¯¾ç¨‹é‡éš¾ç‚¹
4. è¯¾ç¨‹æ€æ”¿å…ƒç´ 

è¯·ç›´æ¥è¾“å‡ºä¿®æ”¹åçš„è¯¾ç¨‹ç›®æ ‡ï¼Œä¸éœ€è¦é¢å¤–è¯´æ˜ï¼š`;
                
                // è°ƒç”¨AI API
                const response = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${CONFIG.API_KEY}`,
                        'Content-Type': 'application/json',
                        'X-DashScope-SSE': 'disable'  // ç¦ç”¨SSEä»¥é¿å…è·¨åŸŸé—®é¢˜
                    },
                    body: JSON.stringify({
                        model: CONFIG.MODEL,
                        messages: [
                            {
                                role: "system",
                                content: "ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºè®¾è®¡é«˜è´¨é‡çš„è¯¾ç¨‹å†…å®¹ã€‚"
                            },
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                const newGoals = data.choices[0].message.content;
                
                // æ›´æ–°è¯¾ç¨‹ç›®æ ‡
                courseGoals = newGoals;
                
                // æ›´æ–°æ˜¾ç¤ºå†…å®¹
                const previewContainer = document.querySelector('#goals-result .preview-container pre');
                previewContainer.textContent = newGoals;
                
                // æ˜¾ç¤ºAIå›å¤
                chatHistory.innerHTML += `
                    <div style="margin-bottom: 10px; padding: 8px; background: #e8f5e9; border-radius: 4px;">
                        <strong>AI:</strong> ${newGoals}
                    </div>
                `;
                
                showSuccess(`è¯¾ç¨‹ç›®æ ‡å·²æ›´æ–°ï¼`);
            } catch (error) {
                console.error("é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡å¤±è´¥:", error);
                showError(`é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡å¤±è´¥: ${error.message}`);
                
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                chatHistory.innerHTML += `
                    <div style="margin-bottom: 10px; padding: 8px; background: #fadbd8; border-radius: 4px;">
                        <strong>ç³»ç»Ÿ:</strong> é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡å¤±è´¥: ${error.message}
                    </div>
                `;
            } finally {
                loading.style.display = 'none';
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
        }

        // ç¼–è¾‘è¯¾ç¨‹ç›®æ ‡
        function editCourseGoals() {
            const resultDiv = document.getElementById('goals-result');
            resultDiv.innerHTML = `
                <div class="input-group">
                    <textarea id="goals-editor" style="width: 100%; height: 300px; font-family: 'Segoe UI', system-ui, sans-serif; font-size: 14px; line-height: 1.6; padding: 15px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;">${courseGoals}</textarea>
                </div>
                <div class="input-group" style="margin-top: 1rem;">
                    <button class="btn btn-success" onclick="saveCourseGoals()" style="color: white;">ä¿å­˜è¯¾ç¨‹ç›®æ ‡</button>
                    <button class="btn btn-secondary" onclick="cancelEditGoals()" style="color: white; margin-left: 10px;">å–æ¶ˆ</button>
                </div>
            `;
        }

        // ä¿å­˜è¯¾ç¨‹ç›®æ ‡
        function saveCourseGoals() {
            const editor = document.getElementById('goals-editor');
            courseGoals = editor.value;
            showSuccess("è¯¾ç¨‹ç›®æ ‡å·²ä¿å­˜ï¼");
            // é‡æ–°æ˜¾ç¤ºé¢„è§ˆ
            document.getElementById('goals-result').innerHTML = `
                <div class="preview-container">
                    <pre style="white-space: pre-wrap; word-wrap: break-word;">${courseGoals}</pre>
                    <div class="input-group" style="margin-top: 1rem;">
                        <button class="btn btn-success" onclick="editCourseGoals()" style="color: white;">ç¼–è¾‘è¯¾ç¨‹ç›®æ ‡</button>
                        <button class="btn btn-secondary" onclick="openGoalsRegenerateDialog()" style="color: white; margin-left: 10px;">é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡</button>
                    </div>
                </div>
            `;
        }

        // å–æ¶ˆç¼–è¾‘è¯¾ç¨‹ç›®æ ‡
        function cancelEditGoals() {
            // é‡æ–°æ˜¾ç¤ºé¢„è§ˆ
            document.getElementById('goals-result').innerHTML = `
                <div class="preview-container">
                    <pre style="white-space: pre-wrap; word-wrap: break-word;">${courseGoals}</pre>
                    <div class="input-group" style="margin-top: 1rem;">
                        <button class="btn btn-success" onclick="editCourseGoals()" style="color: white;">ç¼–è¾‘è¯¾ç¨‹ç›®æ ‡</button>
                        <button class="btn btn-secondary" onclick="openGoalsRegenerateDialog()" style="color: white; margin-left: 10px;">é‡æ–°ç”Ÿæˆè¯¾ç¨‹ç›®æ ‡</button>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆè¯¾ç¨‹ææ–™
        async function generateCourseMaterials() {
            if (!courseGoals) {
                showError("è¯·å…ˆç”Ÿæˆè¯¾ç¨‹ç›®æ ‡");
                return;
            }

            const loading = document.getElementById('materials-loading');
            const resultDiv = document.getElementById('materials-result');
            const previewSection = document.getElementById('materials-preview');
            const previewCards = document.getElementById('material-preview-cards');

            try {
                loading.style.display = 'block';
                resultDiv.innerHTML = '';
                previewCards.innerHTML = '';

                // æ ¹æ®è¯¾ç¨‹ç±»å‹ç¡®å®šæ ¸å¿ƒç¯èŠ‚
                let coreLoops = [];
                if (currentCourseType === 'kiro') {
                    coreLoops = KIRO_CONFIG.CORE_LOOPS;
                } else if (currentCourseType === 'microcontroller') {
                    coreLoops = MICROCONTROLLER_CONFIG.CORE_LOOPS;
                } else if (currentCourseType === 'python') {
                    coreLoops = PYTHON_CONFIG.CORE_LOOPS;
                } else {
                    coreLoops = [
                        "è¯¾å‰é¢„çƒ­",
                        "è¯¾å ‚æ¸¸æˆè®¾è®¡",
                        "æ¿ä¹¦è®¾è®¡",
                        "äº²å­ä»»åŠ¡",
                        "çº¸è´¨ä½œä¸š",
                        "è¯¾ååé¦ˆ"
                    ];
                }

                // é€ä¸ªç”Ÿæˆææ–™
                for (let i = 0; i < coreLoops.length; i++) {
                    const type = coreLoops[i];
                    try {
                        // æ˜¾ç¤ºæ­£åœ¨ç”Ÿæˆçš„ææ–™ç±»å‹
                        resultDiv.innerHTML = `<div class="loading">æ­£åœ¨ç”Ÿæˆ${type}...</div>`;
                        
                        // ç”Ÿæˆæç¤ºè¯
                        const prompt = generateMaterialPrompt(type);
                        
                        // è°ƒç”¨AI API
                        const response = await fetch(CONFIG.API_URL, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${CONFIG.API_KEY}`,
                                'Content-Type': 'application/json',
                                'X-DashScope-SSE': 'disable'  // ç¦ç”¨SSEä»¥é¿å…è·¨åŸŸé—®é¢˜
                            },
                            body: JSON.stringify({
                                model: CONFIG.MODEL,
                                messages: [
                                    {
                                        role: "system",
                                        content: "ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºè®¾è®¡é«˜è´¨é‡çš„è¯¾ç¨‹å†…å®¹ã€‚"
                                    },
                                    {
                                        role: "user",
                                        content: prompt
                                    }
                                ],
                                temperature: 0.7
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        const content = data.choices[0].message.content;
                        
                        // ä¿å­˜åˆ°å…¨å±€å˜é‡
                        courseMaterials[type] = content;
                    } catch (error) {
                        console.error(`ç”Ÿæˆ${type}å¤±è´¥:`, error);
                        courseMaterials[type] = `ç”Ÿæˆ${type}æ—¶å‡ºç°é”™è¯¯: ${error.message}`;
                    }
                }

                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showSuccess("æ‰€æœ‰è¯¾ç¨‹ææ–™å·²ç”Ÿæˆå®Œæˆï¼");
                
                // æ˜¾ç¤ºææ–™é¢„è§ˆ
                displayCourseMaterials();
                
                // æ˜¾ç¤ºé¢„è§ˆåŒºåŸŸ
                previewSection.style.display = 'block';
            } catch (error) {
                console.error("ç”Ÿæˆè¯¾ç¨‹ææ–™å¤±è´¥:", error);
                showError(`ç”Ÿæˆè¯¾ç¨‹ææ–™å¤±è´¥: ${error.message}`);
            } finally {
                loading.style.display = 'none';
            }
        }

        // ç”Ÿæˆææ–™æç¤ºè¯
        function generateMaterialPrompt(type) {
            let prompt = "";
            
            if (currentCourseType === 'kiro') {
                // Kiroè¯¾ç¨‹æç¤ºè¯
                prompt = `ä½ æ˜¯ä¸€ä½æ‹¥æœ‰8å¹´ä¸€çº¿æ•™å­¦ç»éªŒçš„ä½é¾„æ®µæœºå™¨äººç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œç‰¹åˆ«æ“…é•¿å¼•å¯¼å¤§ç­è‡³ä¸€å¹´çº§çš„å­©å­ã€‚ä½ çš„æ•™å­¦æ ¹åŸºæ˜¯"å»ºæ„ä¸»ä¹‰"ä¸"æ¸¸æˆåŒ–å­¦ä¹ "ï¼Œä½ æ·±ä¿¡æ•™è‚²çš„æœ¬è´¨ä¸æ˜¯çŒè¾“ï¼Œè€Œæ˜¯ç‚¹ç‡ƒå¥½å¥‡å¿ƒï¼Œå¹¶ä¸ºå­©å­æ­å»ºé€šå¾€çŸ¥è¯†çš„è„šæ‰‹æ¶ã€‚ä½ ä¸ä»…ç²¾é€šæŠ€æœ¯ï¼Œæ›´æ·±è°™å„¿ç«¥å¿ƒç†å­¦ï¼Œèƒ½ç²¾å‡†åœ°å°†æŠ½è±¡æ¦‚å¿µè½¬åŒ–ä¸ºé€‚åˆå­©å­è®¤çŸ¥çš„è¶£å‘³æ´»åŠ¨ã€‚

è¯·æ ¹æ®ä»¥ä¸‹è¯¾ç¨‹ç›®æ ‡ç”Ÿæˆ${type}å†…å®¹ï¼š

è¯¾ç¨‹ç›®æ ‡ï¼š
${courseGoals}

è¯·æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ç”Ÿæˆå†…å®¹ï¼š
- å†…å®¹éœ€ç¬¦åˆå¤§ç­è‡³ä¸€å¹´çº§å„¿ç«¥è®¤çŸ¥ç‰¹ç‚¹
- ä½“ç°å»ºæ„ä¸»ä¹‰ä¸æ¸¸æˆåŒ–å­¦ä¹ ç†å¿µ
- æ ¼å¼æ¸…æ™°æ˜“è¯»
- ç‰¹åˆ«æ³¨æ„ï¼š${type}çš„æ ¼å¼è¦æ±‚ä¸ºï¼š${KIRO_CONFIG.CORE_LOOPS.includes(type) ? "è¯·æ ¹æ®Kiroè¯¾ç¨‹ç‰¹ç‚¹ç”Ÿæˆç›¸åº”å†…å®¹" : "è¯·æ ¹æ®æ•™è‚²ä»·å€¼åˆç†è®¾è®¡"}
- å…¶ä»–å†…å®¹è¯·æ ¹æ®æ•™è‚²ä»·å€¼åˆç†è®¾è®¡

è¯·ç›´æ¥è¾“å‡º${type}å†…å®¹ï¼Œä¸éœ€è¦é¢å¤–è¯´æ˜ï¼š`;
            } else if (currentCourseType === 'microcontroller') {
                // å•ç‰‡æœºè¯¾ç¨‹æç¤ºè¯
                prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºå•ç‰‡æœºå’Œç¡¬ä»¶ç¼–ç¨‹æ•™å­¦ï¼Œç‰¹åˆ«æ“…é•¿å¼•å¯¼2-4å¹´çº§çš„å­©å­ã€‚ä½ çš„æ•™å­¦ç»“åˆäº†ç¡¬ä»¶æ­å»ºå’Œè½¯ä»¶ç¼–ç¨‹ï¼Œæ³¨é‡åŸ¹å…»å­©å­çš„åŠ¨æ‰‹èƒ½åŠ›å’Œé€»è¾‘æ€ç»´ã€‚

è¯·æ ¹æ®ä»¥ä¸‹è¯¾ç¨‹ç›®æ ‡ç”Ÿæˆ${type}å†…å®¹ï¼š

è¯¾ç¨‹ç›®æ ‡ï¼š
${courseGoals}

è¯·æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ç”Ÿæˆå†…å®¹ï¼š
- å†…å®¹éœ€ç¬¦åˆ2-4å¹´çº§å„¿ç«¥è®¤çŸ¥ç‰¹ç‚¹
- ç»“åˆç¡¬ä»¶æ­å»ºå’ŒScratchç¼–ç¨‹
- ä½“ç°STEAMæ•™è‚²ç†å¿µ
- æ ¼å¼è¦æ±‚ï¼š`;
                
                // æ ¹æ®ææ–™ç±»å‹æ·»åŠ å…·ä½“è¦æ±‚
                switch (type) {
                    case "è¯¾å ‚å†…å®¹":
                        prompt += "å›¾ç‰‡å½¢å¼ï¼Œè¯¾ç¨‹é¢„å‘Šï¼Œç®€å•æ˜“æ‡‚åœ°å‘Šè¯‰å®¶é•¿è¿™èŠ‚è¯¾æˆ‘ä»¬å­¦ä»€ä¹ˆï¼Œå­©å­ä¼šæŒæ¡ä»€ä¹ˆèƒ½åŠ›ï¼Œä¸å­¦ç§‘ç›¸å…³çš„çŸ¥è¯†æˆ–è€…ç»“æ„";
                        break;
                    case "è¯¾å ‚æ¿ä¹¦":
                        prompt += "å›¾ç‰‡å½¢å¼ï¼Œç»™è€å¸ˆåšå‚è€ƒï¼Œå­©å­ä»¬ä¼šæŠ„å†™è€å¸ˆçš„æ¿ä¹¦";
                        break;
                    case "è¯¾åä½œä¸š":
                        prompt += "Wordå½¢å¼ï¼ŒåŒ…å«å•è¯ç§¯ç´¯ã€æ•°å­¦åŠ æ²¹ç«™ã€è¯»ä»£ç ã€ç¼–å†™ç¨‹åºå‡ éƒ¨åˆ†ï¼Œç»“åˆå­¦æ ¡è¯¾æ ‡å’Œç¼–ç¨‹è€ƒçº§çœŸé¢˜";
                        break;
                    case "è¯¾ååé¦ˆ":
                        prompt += "Wordå½¢å¼ï¼Œç»™å®¶é•¿åé¦ˆå­©å­çš„è¡¨ç°ï¼ŒåŸºäºè¯¾å ‚ç›®æ ‡ç”Ÿæˆï¼Œè¦ç•™å‡ºè€å¸ˆè‡ªç”±å‘æŒ¥éƒ¨åˆ†";
                        break;
                    case "è¯¾åæ‰©å±•":
                        prompt += "Wordå½¢å¼ï¼Œå¯¹åº”çš„æ•°å­¦æ€ç»´ã€ç§‘å­¦å®éªŒã€æˆ–è€…ç«èµ›é¢˜";
                        break;
                    case "ç§‘å­¦å®éªŒ":
                        prompt += "Wordå½¢å¼ï¼Œæé«˜å­©å­çš„å…´è¶£ï¼Œæ¯èŠ‚è¯¾æœ‰ä¸€ä¸ªæ¸¸æˆæˆ–è€…å°å®éªŒ";
                        break;
                    default:
                        prompt += "è¯·æ ¹æ®æ•™è‚²ä»·å€¼åˆç†è®¾è®¡";
                }
                
                prompt += `
- å…¶ä»–å†…å®¹è¯·æ ¹æ®æ•™è‚²ä»·å€¼åˆç†è®¾è®¡

è¯·ç›´æ¥è¾“å‡º${type}å†…å®¹ï¼Œä¸éœ€è¦é¢å¤–è¯´æ˜ï¼š`;
            } else if (currentCourseType === 'python') {
                // Pythonè¯¾ç¨‹æç¤ºè¯
                prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºPythonç¼–ç¨‹æ•™å­¦ï¼Œç‰¹åˆ«æ“…é•¿å¼•å¯¼4å¹´çº§åˆ°åˆäºŒçš„å­¦ç”Ÿã€‚ä½ çš„æ•™å­¦æ³¨é‡åŸ¹å…»å­¦ç”Ÿçš„ç¼–ç¨‹æ€ç»´ã€é€»è¾‘æ€ç»´å’Œè§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›ï¼Œå¼ºè°ƒä¸æ•°å­¦ã€è‹±è¯­ç­‰å­¦ç§‘çš„èåˆã€‚

è¯·æ ¹æ®ä»¥ä¸‹è¯¾ç¨‹ç›®æ ‡ç”Ÿæˆ${type}å†…å®¹ï¼š

è¯¾ç¨‹ç›®æ ‡ï¼š
${courseGoals}

è¯·æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ç”Ÿæˆå†…å®¹ï¼š
- å†…å®¹éœ€ç¬¦åˆ4å¹´çº§åˆ°åˆäºŒå­¦ç”Ÿçš„è®¤çŸ¥ç‰¹ç‚¹
- ä½“ç°ç¼–ç¨‹æ€ç»´å’Œé€»è¾‘æ€ç»´è®­ç»ƒ
- å¼ºè°ƒä¸æ•°å­¦ã€è‹±è¯­ç­‰å­¦ç§‘çš„èåˆ
- åŸ¹å…»å­¦ç”Ÿåˆ†æå’Œè§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›
- æ ¼å¼è¦æ±‚ï¼š`;
                
                // æ ¹æ®ææ–™ç±»å‹æ·»åŠ å…·ä½“è¦æ±‚
                switch (type) {
                    case "è¯¾å ‚å†…å®¹":
                        prompt += "å›¾ç‰‡å½¢å¼ï¼Œè¯¾ç¨‹é¢„å‘Šï¼Œç®€å•æ˜“æ‡‚åœ°å‘Šè¯‰å®¶é•¿è¿™èŠ‚è¯¾æˆ‘ä»¬å­¦ä»€ä¹ˆï¼Œå­©å­ä¼šæŒæ¡ä»€ä¹ˆèƒ½åŠ›ï¼Œä¸å­¦ç§‘ç›¸å…³çš„çŸ¥è¯†";
                        break;
                    case "è¯¾å ‚æ¿ä¹¦":
                        prompt += "å›¾ç‰‡å½¢å¼ï¼Œç»™è€å¸ˆåšå‚è€ƒï¼Œå­©å­ä»¬ä¼šæŠ„å†™è€å¸ˆçš„æ¿ä¹¦";
                        break;
                    case "è¯¾åä½œä¸š":
                        prompt += "Wordå½¢å¼ï¼ŒåŒ…å«å•è¯ç§¯ç´¯ã€æ•°å­¦åŠ æ²¹ç«™ã€è¯»ä»£ç ã€ç¼–å†™ç¨‹åºå››éƒ¨åˆ†ï¼Œç»“åˆå­¦æ ¡è¯¾æ ‡å’Œç¼–ç¨‹è€ƒçº§çœŸé¢˜";
                        break;
                    case "è¯¾ååé¦ˆ":
                        prompt += "Wordå½¢å¼ï¼Œç»™å®¶é•¿åé¦ˆå­©å­çš„è¡¨ç°ï¼ŒåŸºäºè¯¾å ‚ç›®æ ‡ç”Ÿæˆï¼Œè¦ç•™å‡ºè€å¸ˆè‡ªç”±å‘æŒ¥éƒ¨åˆ†";
                        break;
                    case "è¯¾åæ‰©å±•":
                        prompt += "Wordå½¢å¼ï¼Œä¸€ä¸ªå°çš„ç¼–ç¨‹ç§‘æ™®æˆ–è®¡ç®—æœºåŸç†ã€æ•°å­¦çŸ¥è¯†ç§‘æ™®ç»™å­©å­";
                        break;
                    default:
                        prompt += "è¯·æ ¹æ®æ•™è‚²ä»·å€¼åˆç†è®¾è®¡";
                }
                
                prompt += `
- å…¶ä»–å†…å®¹è¯·æ ¹æ®æ•™è‚²ä»·å€¼åˆç†è®¾è®¡

è¯·ç›´æ¥è¾“å‡º${type}å†…å®¹ï¼Œä¸éœ€è¦é¢å¤–è¯´æ˜ï¼š`;
            } else {
                // Uaroè¯¾ç¨‹æç¤ºè¯
                prompt = `æ‚¨æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œè¯·æ ¹æ®ä»¥ä¸‹è¯¾ç¨‹ç›®æ ‡ç”Ÿæˆ${type}å†…å®¹ï¼š

è¯¾ç¨‹ç›®æ ‡ï¼š
${courseGoals}

è¯·æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ç”Ÿæˆå†…å®¹ï¼š
- å†…å®¹éœ€ç¬¦åˆ3-6å²å„¿ç«¥è®¤çŸ¥ç‰¹ç‚¹
- ä½“ç°æ¸¸æˆåŒ–å­¦ä¹ ç†å¿µ
- æ ¼å¼æ¸…æ™°æ˜“è¯»
- ç‰¹åˆ«æ³¨æ„ï¼š${type}çš„æ ¼å¼è¦æ±‚ä¸ºï¼š`;
                
                // æ ¹æ®ææ–™ç±»å‹æ·»åŠ å…·ä½“è¦æ±‚
                switch (type) {
                    case "è¯¾å‰é¢„çƒ­":
                        prompt += "å›¾ç‰‡å½¢å¼ï¼Œç”¨äºè¯¾å‰å‘ç»™å®¶é•¿çš„äº²å­äº’åŠ¨æ¸¸æˆï¼ŒåŒ…å«åˆ¶é€ ç¥ç§˜æ„Ÿçš„é¢„å‘Šè¯æœ¯å’Œç®€å•çš„å®¶å›­äº’åŠ¨ä»»åŠ¡ï¼Œè¦æ±‚ä»¥å¯è§†åŒ–çš„æ–¹å¼å‘ˆç°ï¼Œæ–¹ä¾¿å®¶é•¿ç†è§£å’Œå‚ä¸";
                        break;
                    case "è¯¾å ‚æ¸¸æˆè®¾è®¡":
                        prompt += "Wordå½¢å¼ï¼ŒåŒ…å«3ä¸ªé€’è¿›å¼æ¸¸æˆæ´»åŠ¨ï¼Œæ¯ä¸ªæ¸¸æˆæ ‡æ³¨å‘å±•é¢†åŸŸã€ç”¨å…·è¯¦æƒ…ã€ç©æ³•æ­¥éª¤";
                        break;
                    case "æ¿ä¹¦è®¾è®¡":
                        prompt += "å›¾ç‰‡å½¢å¼ï¼Œæ¨ªå‘ä¸‰æ å¸ƒå±€ï¼šçŸ¥è¯†åŒºã€æ´»åŠ¨åŒºã€æˆæœåŒºï¼Œå›¾æ–‡ç»“åˆï¼Œå…³é”®è¯çªå‡ºï¼Œè¦æ±‚ä»¥å¯è§†åŒ–å›¾è¡¨çš„æ–¹å¼å‘ˆç°";
                        break;
                    case "äº²å­ä»»åŠ¡":
                        prompt += "Wordå½¢å¼ï¼Œä¸‰é€‰ä¸€æ¨¡å¼ï¼ˆåŸºç¡€ç‰ˆï¼šçŸ¥è¯†å·©å›ºå‹ï¼Œè¿›é˜¶ç‰ˆï¼šæŠ€èƒ½æ‹“å±•å‹ï¼Œåˆ›æ„ç‰ˆï¼šè¡¨è¾¾åˆ›é€ å‹ï¼‰";
                        break;
                    case "çº¸è´¨ä½œä¸š":
                        prompt += "Wordå½¢å¼ï¼Œå›¾ç”»ä¸ºä¸»ï¼Œæ–‡å­—ä¸ºè¾…ï¼Œèåˆæ•°å­¦å¯è’™å…ƒç´ ";
                        break;
                    case "è¯¾ååé¦ˆ":
                        prompt += "Wordå½¢å¼ï¼ŒåŸºäºè¯¾ç¨‹ç›®æ ‡è¯„ä»·å­©å­è¡¨ç°";
                        break;
                    default:
                        prompt += "è¯·æ ¹æ®æ•™è‚²ä»·å€¼åˆç†è®¾è®¡";
                }
                
                prompt += `
- å…¶ä»–å†…å®¹è¯·æ ¹æ®æ•™è‚²ä»·å€¼åˆç†è®¾è®¡

è¯·ç›´æ¥è¾“å‡º${type}å†…å®¹ï¼Œä¸éœ€è¦é¢å¤–è¯´æ˜ï¼š`;
            }
            
            return prompt;
        }

        // æ˜¾ç¤ºè¯¾ç¨‹ææ–™
        function displayCourseMaterials() {
            const previewCards = document.getElementById('material-preview-cards');
            
            previewCards.innerHTML = '';
            
            // åˆ›å»ºé¢„è§ˆå¡ç‰‡
            const materialEntries = Object.entries(courseMaterials);
            for (let i = 0; i < materialEntries.length; i++) {
                const [type, content] = materialEntries[i];
                const card = document.createElement('div');
                card.className = 'material-card';
                
                // æ ¹æ®ææ–™ç±»å‹ç¡®å®šå¯¼å‡ºæ ¼å¼
                let isImageFormat = false;
                if (currentCourseType === 'kiro') {
                    isImageFormat = type.includes('ç”Ÿæˆå®¶é•¿å›¾ç‰‡') || type.includes('è®¾è®¡æ¿ä¹¦');
                } else if (currentCourseType === 'microcontroller') {
                    isImageFormat = type.includes('è¯¾å ‚å†…å®¹') || type.includes('è¯¾å ‚æ¿ä¹¦');
                } else if (currentCourseType === 'python') {
                    isImageFormat = type.includes('è¯¾å ‚å†…å®¹') || type.includes('è¯¾å ‚æ¿ä¹¦');
                } else {
                    isImageFormat = type.includes('è¯¾å‰é¢„çƒ­') || type.includes('æ¿ä¹¦è®¾è®¡');
                }
                
                // ä¸ºæ¯ä¸ªææ–™ç±»å‹ç”Ÿæˆå”¯ä¸€çš„ID
                const uniqueId = type.replace(/\s+/g, '-');
                
                card.innerHTML = `
                    <h3>${type}</h3>
                    <div style="margin-bottom: 10px;">
                        <textarea id="textarea-${uniqueId}" style="width: 100%; height: 200px; font-family: 'Segoe UI', system-ui, sans-serif; font-size: 14px; line-height: 1.6; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;">${content}</textarea>
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-success" onclick="saveAndExportMaterial('${type}', 'textarea-${uniqueId}')" style="color: white;">ä¿å­˜å¹¶å¯¼å‡º${type}</button>
                        <button class="btn btn-secondary" onclick="saveMaterial('${type}', 'textarea-${uniqueId}')" style="color: white; margin-left: 10px;">ä¿å­˜${type}</button>
                        <button class="btn btn-secondary" onclick="exportMaterial('${type}', 'textarea-${uniqueId}')" style="color: white; margin-left: 10px;">å¯¼å‡º${type}</button>
                        <button class="btn btn-secondary" onclick="openRegenerateDialog('${type}', 'textarea-${uniqueId}')" style="color: white; margin-left: 10px;">é‡æ–°ç”Ÿæˆ${type}</button>
                        <span style="margin-left: 10px; font-size: 0.9em; color: #666;">æ ¼å¼: ${isImageFormat ? 'å›¾ç‰‡' : 'Word'}</span>
                    </div>
                    <!-- é‡æ–°ç”Ÿæˆå¯¹è¯æ¡† -->
                    <div id="regenerate-dialog-${uniqueId}" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9;">
                        <h4>é‡æ–°ç”Ÿæˆ ${type}</h4>
                        <div id="chat-history-${uniqueId}" style="max-height: 200px; overflow-y: auto; margin-bottom: 10px; padding: 10px; background: white; border-radius: 4px; border: 1px solid #eee;">
                            <!-- å¯¹è¯å†å²å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                        <div style="display: flex;">
                            <input type="text" id="chat-input-${uniqueId}" placeholder="è¾“å…¥æ‚¨çš„ä¿®æ”¹è¦æ±‚..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                            <button class="btn btn-secondary" onclick="sendChatMessage('${type}', 'textarea-${uniqueId}', '${uniqueId}')" style="color: white;">å‘é€</button>
                            <button class="btn btn-secondary" onclick="closeRegenerateDialog('${uniqueId}')" style="color: white; margin-left: 10px;">å…³é—­</button>
                        </div>
                        <div class="loading" id="regenerate-loading-${uniqueId}" style="display: none; margin-top: 10px;">AIæ­£åœ¨é‡æ–°ç”Ÿæˆå†…å®¹...</div>
                    </div>
                `;
                previewCards.appendChild(card);
            }
            
            // æ˜¾ç¤ºé¢„è§ˆåŒºåŸŸ
            document.getElementById('materials-preview').style.display = 'block';
        }

        // æ‰“å¼€é‡æ–°ç”Ÿæˆå¯¹è¯æ¡†
        function openRegenerateDialog(type, textareaId) {
            const uniqueId = type.replace(/\s+/g, '-');
            const dialog = document.getElementById(`regenerate-dialog-${uniqueId}`);
            dialog.style.display = 'block';
            
            // åˆå§‹åŒ–å¯¹è¯å†å²
            const chatHistory = document.getElementById(`chat-history-${uniqueId}`);
            chatHistory.innerHTML = `
                <div style="margin-bottom: 10px; padding: 8px; background: #e3f2fd; border-radius: 4px;">
                    <strong>ç³»ç»Ÿ:</strong> æ‚¨å¯ä»¥å‘Šè¯‰æˆ‘æ‚¨å¯¹"${type}"å†…å®¹çš„å…·ä½“è¦æ±‚ï¼Œæˆ‘ä¼šæ ¹æ®æ‚¨çš„è¦æ±‚é‡æ–°ç”Ÿæˆå†…å®¹ã€‚
                </div>
            `;
        }

        // å…³é—­é‡æ–°ç”Ÿæˆå¯¹è¯æ¡†
        function closeRegenerateDialog(uniqueId) {
            const dialog = document.getElementById(`regenerate-dialog-${uniqueId}`);
            dialog.style.display = 'none';
        }

        // å‘é€èŠå¤©æ¶ˆæ¯
        async function sendChatMessage(type, textareaId, uniqueId) {
            const input = document.getElementById(`chat-input-${uniqueId}`);
            const message = input.value.trim();
            
            if (!message) {
                showError("è¯·è¾“å…¥æ‚¨çš„ä¿®æ”¹è¦æ±‚");
                return;
            }
            
            const chatHistory = document.getElementById(`chat-history-${uniqueId}`);
            const loading = document.getElementById(`regenerate-loading-${uniqueId}`);
            
            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            chatHistory.innerHTML += `
                <div style="margin-bottom: 10px; padding: 8px; background: #f0f0f0; border-radius: 4px;">
                    <strong>æ‚¨:</strong> ${message}
                </div>
            `;
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            input.value = '';
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loading.style.display = 'block';
            chatHistory.scrollTop = chatHistory.scrollHeight;
            
            try {
                // æ„å»ºæç¤ºè¯
                let prompt = `æ‚¨æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹è¦æ±‚é‡æ–°ç”Ÿæˆ"${type}"å†…å®¹ï¼š

å½“å‰è¯¾ç¨‹ç›®æ ‡ï¼š
${courseGoals}

ç”¨æˆ·çš„å…·ä½“è¦æ±‚ï¼š
${message}

è¯·ç›´æ¥è¾“å‡ºä¿®æ”¹åçš„å†…å®¹ï¼Œä¸éœ€è¦é¢å¤–è¯´æ˜ï¼š`;
                
                // è°ƒç”¨AI API
                const response = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${CONFIG.API_KEY}`,
                        'Content-Type': 'application/json',
                        'X-DashScope-SSE': 'disable'  // ç¦ç”¨SSEä»¥é¿å…è·¨åŸŸé—®é¢˜
                    },
                    body: JSON.stringify({
                        model: CONFIG.MODEL,
                        messages: [
                            {
                                role: "system",
                                content: "ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å°‘å„¿ç¼–ç¨‹æ•™è‚²ä¸“å®¶ï¼Œä¸“æ³¨äºè®¾è®¡é«˜è´¨é‡çš„è¯¾ç¨‹å†…å®¹ã€‚"
                            },
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                const newContent = data.choices[0].message.content;
                
                // æ›´æ–°textareaå†…å®¹
                const textarea = document.getElementById(textareaId);
                textarea.value = newContent;
                
                // æ›´æ–°å…¨å±€å˜é‡
                courseMaterials[type] = newContent;
                
                // æ˜¾ç¤ºAIå›å¤
                chatHistory.innerHTML += `
                    <div style="margin-bottom: 10px; padding: 8px; background: #e8f5e9; border-radius: 4px;">
                        <strong>AI:</strong> ${newContent}
                    </div>
                `;
                
                showSuccess(`${type}å†…å®¹å·²æ›´æ–°ï¼`);
            } catch (error) {
                console.error("é‡æ–°ç”Ÿæˆå†…å®¹å¤±è´¥:", error);
                showError(`é‡æ–°ç”Ÿæˆå†…å®¹å¤±è´¥: ${error.message}`);
                
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                chatHistory.innerHTML += `
                    <div style="margin-bottom: 10px; padding: 8px; background: #fadbd8; border-radius: 4px;">
                        <strong>ç³»ç»Ÿ:</strong> é‡æ–°ç”Ÿæˆå†…å®¹å¤±è´¥: ${error.message}
                    </div>
                `;
            } finally {
                loading.style.display = 'none';
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
        }

        // ä¿å­˜ææ–™
        function saveMaterial(type, textareaId) {
            const textarea = document.getElementById(textareaId);
            courseMaterials[type] = textarea.value;
            showSuccess(`${type}å·²ä¿å­˜ï¼`);
        }

        // å¯¼å‡ºææ–™
        function exportMaterial(type, textareaId) {
            const textarea = document.getElementById(textareaId);
            const content = textarea.value;
            
            // æ ¹æ®ææ–™ç±»å‹ç¡®å®šå¯¼å‡ºæ ¼å¼
            let isImageFormat = false;
            if (currentCourseType === 'kiro') {
                isImageFormat = type.includes('ç”Ÿæˆå®¶é•¿å›¾ç‰‡') || type.includes('è®¾è®¡æ¿ä¹¦');
            } else if (currentCourseType === 'microcontroller') {
                isImageFormat = type.includes('è¯¾å ‚å†…å®¹') || type.includes('è¯¾å ‚æ¿ä¹¦');
            } else if (currentCourseType === 'python') {
                isImageFormat = type.includes('è¯¾å ‚å†…å®¹') || type.includes('è¯¾å ‚æ¿ä¹¦');
            } else {
                isImageFormat = type.includes('è¯¾å‰é¢„çƒ­') || type.includes('æ¿ä¹¦è®¾è®¡');
            }
            
            if (isImageFormat) {
                exportMaterialAsImage(type, content, '.png');
            } else {
                exportMaterialAsWord(type, content, '.doc');
            }
        }

        // ä¿å­˜å¹¶å¯¼å‡ºææ–™
        function saveAndExportMaterial(type, textareaId) {
            saveMaterial(type, textareaId);
            exportMaterial(type, textareaId);
        }

        // å¯¼å‡ºä¸ºå›¾ç‰‡
        function exportMaterialAsImage(type, content, fileExtension) {
            // åˆ›å»ºä¸´æ—¶å…ƒç´ ç”¨äºæ¸²æŸ“
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            tempDiv.style.width = '800px';
            tempDiv.style.padding = '20px';
            tempDiv.style.background = 'white';
            tempDiv.style.fontFamily = "'Microsoft YaHei', Arial, sans-serif";
            
            // æ ¹æ®è¯¾ç¨‹ç±»å‹å’Œææ–™ç±»å‹åˆ›å»ºä¸åŒçš„æ¨¡æ¿
            let innerHTML = '';
            
            if (currentCourseType === 'kiro') {
                if (type.includes('ç”Ÿæˆå®¶é•¿å›¾ç‰‡')) {
                    // Kiroè¯¾ç¨‹å®¶åº­ä»»åŠ¡å¡æ¨¡æ¿
                    innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 20px; font-family: 'Microsoft YaHei', sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); border-radius: 8px 8px 0 0; color: white;">
                                <h1 style="margin: 0; font-size: 24px;">ğŸƒ å®¶åº­ä»»åŠ¡å¡</h1>
                                <div style="font-size: 14px; margin-top: 5px;">Kiroè¯¾ç¨‹ Â· å¡ç‰‡å¼ç¼–ç¨‹</div>
                            </div>
                            <div style="padding: 20px; background: #f9f9f9;">
                                <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #9b59b6;">
                                    <h2 style="color: #9b59b6; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ¯</span> ä»Šæ—¥ä»»åŠ¡
                                    </h2>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6;">${content}</div>
                                </div>
                                <div style="display: flex; gap: 20px;">
                                    <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border-left: 4px solid #3498db;">
                                        <h3 style="color: #3498db; margin-top: 0; display: flex; align-items: center;">
                                            <span style="font-size: 20px; margin-right: 8px;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span> äº²å­äº’åŠ¨
                                        </h3>
                                        <div style="white-space: pre-wrap; font-size: 14px; line-height: 1.6; color: #666;">å’Œå­©å­ä¸€èµ·å®Œæˆè¿™ä¸ªæœ‰è¶£çš„ç¼–ç¨‹ä»»åŠ¡å§ï¼</div>
                                    </div>
                                    <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border-left: 4px solid #2ecc71;">
                                        <h3 style="color: #2ecc71; margin-top: 0; display: flex; align-items: center;">
                                            <span style="font-size: 20px; margin-right: 8px;">ğŸ†</span> æˆé•¿æ”¶è·
                                        </h3>
                                        <div style="white-space: pre-wrap; font-size: 14px; line-height: 1.6; color: #666;">é€»è¾‘æ€ç»´ã€é—®é¢˜è§£å†³èƒ½åŠ›</div>
                                    </div>
                                </div>
                            </div>
                            <div style="padding: 15px; text-align: center; background: #f0f0f0; border-radius: 0 0 8px 8px; font-size: 12px; color: #666;">
                                ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                            </div>
                        </div>
                    `;
                } else if (type.includes('è®¾è®¡æ¿ä¹¦')) {
                    // Kiroè¯¾ç¨‹å¯äº¤äº’ç¼–ç¨‹å¢™æ¨¡æ¿
                    innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 20px; font-family: 'Microsoft YaHei', sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-radius: 8px 8px 0 0; color: white;">
                                <h1 style="margin: 0; font-size: 24px;">ğŸ“‹ å¯äº¤äº’ç¼–ç¨‹å¢™</h1>
                                <div style="font-size: 14px; margin-top: 5px;">Kiroè¯¾ç¨‹ Â· å¡ç‰‡å¼ç¼–ç¨‹</div>
                            </div>
                            <div style="padding: 20px; display: flex; gap: 20px;">
                                <div style="flex: 1; background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                                    <h3 style="color: #3498db; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ“–</span> çŸ¥è¯†è¦ç‚¹
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: white; padding: 10px; border-radius: 4px; border: 1px dashed #3498db;">
                                        ${content}
                                    </div>
                                </div>
                                <div style="flex: 1; background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #f39c12;">
                                    <h3 style="color: #f39c12; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ”§</span> æ“ä½œæ­¥éª¤
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: white; padding: 10px; border-radius: 4px; border: 1px dashed #f39c12; min-height: 100px;">
                                        <div style="color: #999; font-style: italic;">è¯·æ ¹æ®è¯¾å ‚å®é™…æƒ…å†µå¡«å†™æ“ä½œæ­¥éª¤...</div>
                                    </div>
                                </div>
                                <div style="flex: 1; background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #2ecc71;">
                                    <h3 style="color: #2ecc71; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">âš ï¸</span> æ³¨æ„äº‹é¡¹
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: white; padding: 10px; border-radius: 4px; border: 1px dashed #2ecc71; min-height: 100px;">
                                        <div style="color: #999; font-style: italic;">è¯·æ ¹æ®è¯¾å ‚å®é™…æƒ…å†µå¡«å†™æ³¨æ„äº‹é¡¹...</div>
                                    </div>
                                </div>
                            </div>
                            <div style="padding: 15px; text-align: center; background: #f5f5f5; border-radius: 0 0 8px 8px; font-size: 12px; color: #666;">
                                ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                            </div>
                        </div>
                    `;
                } else {
                    // Kiroè¯¾ç¨‹é€šç”¨å›¾ç‰‡æ¨¡æ¿
                    innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 20px; font-family: 'Microsoft YaHei', sans-serif;">
                            <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); border-radius: 12px 12px 0 0; color: white;">
                                <h1 style="margin: 0; font-size: 28px;">${type}</h1>
                                <div style="font-size: 16px; margin-top: 10px;">Kiroè¯¾ç¨‹ Â· å¡ç‰‡å¼ç¼–ç¨‹</div>
                            </div>
                            <div style="padding: 20px; background: #f9f9f9;">
                                <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6;">${content}</div>
                            </div>
                            <div style="padding: 15px; text-align: center; background: #f0f0f0; border-radius: 0 0 12px 12px; font-size: 12px; color: #666;">
                                ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                            </div>
                        </div>
                    `;
                }
            } else if (currentCourseType === 'microcontroller') {
                if (type.includes('è¯¾å ‚å†…å®¹')) {
                    // å•ç‰‡æœºè¯¾ç¨‹è¯¾å ‚å†…å®¹æ¨¡æ¿
                    innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 20px; font-family: 'Microsoft YaHei', sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #f39c12 0%, #d68910 100%); border-radius: 8px 8px 0 0; color: white;">
                                <h1 style="margin: 0; font-size: 24px;">âš™ï¸ è¯¾å ‚å†…å®¹é¢„å‘Š</h1>
                                <div style="font-size: 14px; margin-top: 5px;">å•ç‰‡æœºè¯¾ç¨‹ Â· 2-4å¹´çº§</div>
                            </div>
                            <div style="padding: 20px; background: #f9f9f9;">
                                <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #f39c12;">
                                    <h2 style="color: #f39c12; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ¯</span> æœ¬èŠ‚è¯¾å­¦ä»€ä¹ˆ
                                    </h2>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6;">${content}</div>
                                </div>
                                <div style="display: flex; gap: 20px;">
                                    <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border-left: 4px solid #3498db;">
                                        <h3 style="color: #3498db; margin-top: 0; display: flex; align-items: center;">
                                            <span style="font-size: 20px; margin-right: 8px;">ğŸ§ </span> å­©å­å°†æŒæ¡çš„èƒ½åŠ›
                                        </h3>
                                        <div style="white-space: pre-wrap; font-size: 14px; line-height: 1.6; color: #666;">åŠ¨æ‰‹èƒ½åŠ›ã€é€»è¾‘æ€ç»´ã€é—®é¢˜è§£å†³èƒ½åŠ›</div>
                                    </div>
                                    <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border-left: 4px solid #2ecc71;">
                                        <h3 style="color: #2ecc71; margin-top: 0; display: flex; align-items: center;">
                                            <span style="font-size: 20px; margin-right: 8px;">ğŸ“š</span> ç›¸å…³å­¦ç§‘çŸ¥è¯†
                                        </h3>
                                        <div style="white-space: pre-wrap; font-size: 14px; line-height: 1.6; color: #666;">ç”µè·¯åŸºç¡€ã€ç¼–ç¨‹é€»è¾‘ã€æ•°å­¦è¿ç®—</div>
                                    </div>
                                </div>
                            </div>
                            <div style="padding: 15px; text-align: center; background: #f0f0f0; border-radius: 0 0 8px 8px; font-size: 12px; color: #666;">
                                ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                            </div>
                        </div>
                    `;
                } else if (type.includes('è¯¾å ‚æ¿ä¹¦')) {
                    // å•ç‰‡æœºè¯¾ç¨‹è¯¾å ‚æ¿ä¹¦æ¨¡æ¿
                    innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 20px; font-family: 'Microsoft YaHei', sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-radius: 8px 8px 0 0; color: white;">
                                <h1 style="margin: 0; font-size: 24px;">ğŸ“‹ è¯¾å ‚æ¿ä¹¦</h1>
                                <div style="font-size: 14px; margin-top: 5px;">å•ç‰‡æœºè¯¾ç¨‹ Â· 2-4å¹´çº§</div>
                            </div>
                            <div style="padding: 20px; display: flex; gap: 20px;">
                                <div style="flex: 1; background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                                    <h3 style="color: #3498db; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ“–</span> çŸ¥è¯†è¦ç‚¹
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: white; padding: 10px; border-radius: 4px; border: 1px dashed #3498db;">
                                        ${content}
                                    </div>
                                </div>
                                <div style="flex: 1; background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #f39c12;">
                                    <h3 style="color: #f39c12; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ”§</span> æ“ä½œæ­¥éª¤
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: white; padding: 10px; border-radius: 4px; border: 1px dashed #f39c12; min-height: 100px;">
                                        <div style="color: #999; font-style: italic;">ç¡¬ä»¶æ­å»ºå’Œç¼–ç¨‹æ­¥éª¤...</div>
                                    </div>
                                </div>
                                <div style="flex: 1; background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #2ecc71;">
                                    <h3 style="color: #2ecc71; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">âš ï¸</span> æ³¨æ„äº‹é¡¹
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: white; padding: 10px; border-radius: 4px; border: 1px dashed #2ecc71; min-height: 100px;">
                                        <div style="color: #999; font-style: italic;">å®‰å…¨æ“ä½œå’Œå¸¸è§é—®é¢˜...</div>
                                    </div>
                                </div>
                            </div>
                            <div style="padding: 15px; text-align: center; background: #f5f5f5; border-radius: 0 0 8px 8px; font-size: 12px; color: #666;">
                                ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                            </div>
                        </div>
                    `;
                } else {
                    // å•ç‰‡æœºè¯¾ç¨‹é€šç”¨å›¾ç‰‡æ¨¡æ¿
                    innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 20px; font-family: 'Microsoft YaHei', sans-serif;">
                            <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); border-radius: 12px 12px 0 0; color: white;">
                                <h1 style="margin: 0; font-size: 28px;">${type}</h1>
                                <div style="font-size: 16px; margin-top: 10px;">å•ç‰‡æœºè¯¾ç¨‹ Â· 2-4å¹´çº§</div>
                            </div>
                            <div style="padding: 20px; background: #f9f9f9;">
                                <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6;">${content}</div>
                            </div>
                            <div style="padding: 15px; text-align: center; background: #f0f0f0; border-radius: 0 0 12px 12px; font-size: 12px; color: #666;">
                                ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                            </div>
                        </div>
                    `;
                }
            } else if (currentCourseType === 'python') {
                if (type.includes('è¯¾å ‚å†…å®¹')) {
                    // Pythonè¯¾ç¨‹è¯¾å ‚å†…å®¹æ¨¡æ¿
                    innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 20px; font-family: 'Microsoft YaHei', sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #f39c12 0%, #d68910 100%); border-radius: 8px 8px 0 0; color: white;">
                                <h1 style="margin: 0; font-size: 24px;">ğŸ è¯¾å ‚å†…å®¹é¢„å‘Š</h1>
                                <div style="font-size: 14px; margin-top: 5px;">Pythonè¯¾ç¨‹ Â· 4å¹´çº§åˆ°åˆäºŒ</div>
                            </div>
                            <div style="padding: 20px; background: #f9f9f9;">
                                <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #f39c12;">
                                    <h2 style="color: #f39c12; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ¯</span> æœ¬èŠ‚è¯¾å­¦ä»€ä¹ˆ
                                    </h2>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6;">${content}</div>
                                </div>
                                <div style="display: flex; gap: 20px;">
                                    <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border-left: 4px solid #3498db;">
                                        <h3 style="color: #3498db; margin-top: 0; display: flex; align-items: center;">
                                            <span style="font-size: 20px; margin-right: 8px;">ğŸ§ </span> å­©å­å°†æŒæ¡çš„èƒ½åŠ›
                                        </h3>
                                        <div style="white-space: pre-wrap; font-size: 14px; line-height: 1.6; color: #666;">ç¼–ç¨‹æ€ç»´ã€é€»è¾‘æ€ç»´ã€é—®é¢˜è§£å†³èƒ½åŠ›</div>
                                    </div>
                                    <div style="flex: 1; background: white; border-radius: 8px; padding: 15px; border-left: 4px solid #2ecc71;">
                                        <h3 style="color: #2ecc71; margin-top: 0; display: flex; align-items: center;">
                                            <span style="font-size: 20px; margin-right: 8px;">ğŸ“š</span> ç›¸å…³å­¦ç§‘çŸ¥è¯†
                                        </h3>
                                        <div style="white-space: pre-wrap; font-size: 14px; line-height: 1.6; color: #666;">æ•°å­¦é€»è¾‘ã€è‹±è¯­è¯æ±‡ã€è®¡ç®—æœºåŸç†</div>
                                    </div>
                                </div>
                            </div>
                            <div style="padding: 15px; text-align: center; background: #f0f0f0; border-radius: 0 0 8px 8px; font-size: 12px; color: #666;">
                                ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                            </div>
                        </div>
                    `;
                } else if (type.includes('è¯¾å ‚æ¿ä¹¦')) {
                    // Pythonè¯¾ç¨‹è¯¾å ‚æ¿ä¹¦æ¨¡æ¿
                    innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 20px; font-family: 'Microsoft YaHei', sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-radius: 8px 8px 0 0; color: white;">
                                <h1 style="margin: 0; font-size: 24px;">ğŸ“‹ è¯¾å ‚æ¿ä¹¦</h1>
                                <div style="font-size: 14px; margin-top: 5px;">Pythonè¯¾ç¨‹ Â· 4å¹´çº§åˆ°åˆäºŒ</div>
                            </div>
                            <div style="padding: 20px; display: flex; gap: 20px;">
                                <div style="flex: 1; background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                                    <h3 style="color: #3498db; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ“–</span> çŸ¥è¯†è¦ç‚¹
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: white; padding: 10px; border-radius: 4px; border: 1px dashed #3498db;">
                                        ${content}
                                    </div>
                                </div>
                                <div style="flex: 1; background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #f39c12;">
                                    <h3 style="color: #f39c12; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ”§</span> ç¼–ç¨‹æ€è·¯
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: white; padding: 10px; border-radius: 4px; border: 1px dashed #f39c12; min-height: 100px;">
                                        <div style="color: #999; font-style: italic;">ç®—æ³•è®¾è®¡å’Œä»£ç å®ç°æ€è·¯...</div>
                                    </div>
                                </div>
                                <div style="flex: 1; background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #2ecc71;">
                                    <h3 style="color: #2ecc71; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">âš ï¸</span> æ³¨æ„äº‹é¡¹
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: white; padding: 10px; border-radius: 4px; border: 1px dashed #2ecc71; min-height: 100px;">
                                        <div style="color: #999; font-style: italic;">è¯­æ³•è¦ç‚¹å’Œå¸¸è§é”™è¯¯...</div>
                                    </div>
                                </div>
                            </div>
                            <div style="padding: 15px; text-align: center; background: #f5f5f5; border-radius: 0 0 8px 8px; font-size: 12px; color: #666;">
                                ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                            </div>
                        </div>
                    `;
                } else {
                    // Pythonè¯¾ç¨‹é€šç”¨å›¾ç‰‡æ¨¡æ¿
                    innerHTML = `
                        <div style="background: white; border-radius: 12px; padding: 20px; font-family: 'Microsoft YaHei', sans-serif;">
                            <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f39c12 0%, #d68910 100%); border-radius: 12px 12px 0 0; color: white;">
                                <h1 style="margin: 0; font-size: 28px;">${type}</h1>
                                <div style="font-size: 16px; margin-top: 10px;">Pythonè¯¾ç¨‹ Â· 4å¹´çº§åˆ°åˆäºŒ</div>
                            </div>
                            <div style="padding: 20px; background: #f9f9f9;">
                                <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6;">${content}</div>
                            </div>
                            <div style="padding: 15px; text-align: center; background: #f0f0f0; border-radius: 0 0 12px 12px; font-size: 12px; color: #666;">
                                ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                            </div>
                        </div>
                    `;
                }
            } else {
                if (type.includes('æ¿ä¹¦è®¾è®¡')) {
                    // Uaroè¯¾ç¨‹æ¿ä¹¦è®¾è®¡ä½¿ç”¨ä¸‰æ å¸ƒå±€
                    innerHTML = `
                        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px 12px 0 0; color: white;">
                            <h1 style="margin: 0; font-size: 28px;">ğŸ“‹ ${type}</h1>
                            <div style="font-size: 16px; margin-top: 10px;">Uaroè¯¾ç¨‹ Â· ç¼–ç ç§¯æœ¨</div>
                        </div>
                        <div style="padding: 20px; background: #f9f9f9;">
                            <div style="display: flex; gap: 20px;">
                                <div style="flex: 1; background: #fff; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <h3 style="color: #3498db; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ“š</span> çŸ¥è¯†åŒº
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: #f8f9fa; padding: 10px; border-radius: 4px;">
                                        ${content}
                                    </div>
                                </div>
                                <div style="flex: 1; background: #fff; padding: 15px; border-radius: 8px; border-left: 4px solid #e74c3c; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <h3 style="color: #e74c3c; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ¯</span> æ´»åŠ¨åŒº
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: #f8f9fa; padding: 10px; border-radius: 4px; min-height: 100px;">
                                        <div style="color: #999; font-style: italic;">è¯¾å ‚æ´»åŠ¨è®¾è®¡...</div>
                                    </div>
                                </div>
                                <div style="flex: 1; background: #fff; padding: 15px; border-radius: 8px; border-left: 4px solid #2ecc71; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <h3 style="color: #2ecc71; margin-top: 0; display: flex; align-items: center;">
                                        <span style="font-size: 20px; margin-right: 8px;">ğŸ†</span> æˆæœåŒº
                                    </h3>
                                    <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6; background: #f8f9fa; padding: 10px; border-radius: 4px; min-height: 100px;">
                                        <div style="color: #999; font-style: italic;">å­¦ç”Ÿä½œå“å±•ç¤º...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 15px; text-align: center; background: #f0f0f0; border-radius: 0 0 12px 12px; font-size: 12px; color: #666;">
                            ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                        </div>
                    `;
                } else if (type.includes('è¯¾å‰é¢„çƒ­')) {
                    // Uaroè¯¾ç¨‹è¯¾å‰é¢„çƒ­ä½¿ç”¨å¯çˆ±é£æ ¼æ¨¡æ¿
                    innerHTML = `
                        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px 12px 0 0; color: white;">
                            <h1 style="margin: 0; font-size: 28px;">${type}</h1>
                            <div style="font-size: 16px; margin-top: 10px;">æ™ºèƒ½è¯¾ç¨‹ç³»ç»Ÿ</div>
                        </div>
                        <div style="padding: 20px; background: #f9f9f9;">
                            <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6;">${content}</div>
                        </div>
                        <div style="padding: 15px; text-align: center; background: #f0f0f0; border-radius: 0 0 12px 12px; font-size: 12px; color: #666;">
                            ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                        </div>
                    `;
                } else {
                    // Uaroè¯¾ç¨‹å…¶ä»–ææ–™ä½¿ç”¨é€šç”¨æ¨¡æ¿
                    innerHTML = `
                        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px 12px 0 0; color: white;">
                            <h1 style="margin: 0; font-size: 28px;">${type}</h1>
                            <div style="font-size: 16px; margin-top: 10px;">æ™ºèƒ½è¯¾ç¨‹ç³»ç»Ÿ</div>
                        </div>
                        <div style="padding: 20px; background: #f9f9f9;">
                            <div style="white-space: pre-wrap; font-size: 16px; line-height: 1.6;">${content}</div>
                        </div>
                        <div style="padding: 15px; text-align: center; background: #f0f0f0; border-radius: 0 0 12px 12px; font-size: 12px; color: #666;">
                            ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ${new Date().toLocaleDateString('zh-CN')}
                        </div>
                    `;
                }
            }
            
            tempDiv.innerHTML = innerHTML;
            document.body.appendChild(tempDiv);
            
            // ä½¿ç”¨html2canvaså°†å†…å®¹è½¬æ¢ä¸ºå›¾ç‰‡
            html2canvas(tempDiv, {
                useCORS: true,
                scale: 2, // æé«˜å›¾ç‰‡è´¨é‡
                backgroundColor: null // ä¿æŒèƒŒæ™¯é€æ˜
            }).then(canvas => {
                // å°†canvasè½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¸‹è½½
                const link = document.createElement('a');
                link.download = `${type}${fileExtension}`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // ç§»é™¤ä¸´æ—¶å…ƒç´ 
                document.body.removeChild(tempDiv);
                
                showSuccess(`${type}å·²å¯¼å‡ºä¸ºå›¾ç‰‡ï¼`);
            }).catch(error => {
                console.error('å¯¼å‡ºå›¾ç‰‡å¤±è´¥:', error);
                showError(`å¯¼å‡ºå›¾ç‰‡å¤±è´¥: ${error.message}`);
                
                // ç§»é™¤ä¸´æ—¶å…ƒç´ 
                document.body.removeChild(tempDiv);
            });
        }

        // å¯¼å‡ºä¸ºWordæ–‡æ¡£
        function exportMaterialAsWord(type, content, fileExtension) {
            // æ ¹æ®è¯¾ç¨‹ç±»å‹å’Œææ–™ç±»å‹åˆ›å»ºä¸åŒçš„æ¨¡æ¿
            let wordContent = '';
            
            if (currentCourseType === 'kiro') {
                // Kiroè¯¾ç¨‹é€šç”¨Wordæ¨¡æ¿
                wordContent = `
<html xmlns:o='urn:schemas-microsoft-com:office:office' 
      xmlns:w='urn:schemas-microsoft-com:office:word' 
      xmlns='http://www.w3.org/TR/REC-html40'>
<head>
    <meta charset='utf-8'>
    <title>${type}</title>
    <!--[if gte mso 9]>
    <xml>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>100</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            margin: 40px;
            background: #fafafa;
        }
        h1 {
            color: #9b59b6;
            text-align: center;
            padding-bottom: 10px;
            background: linear-gradient(135deg, #d9b3ff 0%, #c299ff 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .content {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 12px;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #9b59b6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>âœ¨ ${type} âœ¨</h1>
    <div class="content">
        <pre>${content}</pre>
    </div>
    <div class="footer">
        ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString('zh-CN')}<br>
        æç¤º: æ•™å¸ˆå¯ç›´æ¥åœ¨æ­¤æ–‡æ¡£ä¸­ç¼–è¾‘å’Œä¿®æ”¹å†…å®¹
    </div>
</body>
</html>`;
            } else if (currentCourseType === 'microcontroller') {
                // å•ç‰‡æœºè¯¾ç¨‹é€šç”¨Wordæ¨¡æ¿
                wordContent = `
<html xmlns:o='urn:schemas-microsoft-com:office:office' 
      xmlns:w='urn:schemas-microsoft-com:office:word' 
      xmlns='http://www.w3.org/TR/REC-html40'>
<head>
    <meta charset='utf-8'>
    <title>${type}</title>
    <!--[if gte mso 9]>
    <xml>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>100</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            margin: 40px;
            background: #fafafa;
        }
        h1 {
            color: #2ecc71;
            text-align: center;
            padding-bottom: 10px;
            background: linear-gradient(135deg, #d5f5e3 0%, #c0f0d0 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .content {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 12px;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2ecc71;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>âœ¨ ${type} âœ¨</h1>
    <div class="content">
        <pre>${content}</pre>
    </div>
    <div class="footer">
        ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString('zh-CN')}<br>
        æç¤º: æ•™å¸ˆå¯ç›´æ¥åœ¨æ­¤æ–‡æ¡£ä¸­ç¼–è¾‘å’Œä¿®æ”¹å†…å®¹
    </div>
</body>
</html>`;
            } else if (currentCourseType === 'python') {
                // Pythonè¯¾ç¨‹é€šç”¨Wordæ¨¡æ¿
                wordContent = `
<html xmlns:o='urn:schemas-microsoft-com:office:office' 
      xmlns:w='urn:schemas-microsoft-com:office:word' 
      xmlns='http://www.w3.org/TR/REC-html40'>
<head>
    <meta charset='utf-8'>
    <title>${type}</title>
    <!--[if gte mso 9]>
    <xml>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>100</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            margin: 40px;
            background: #fafafa;
        }
        h1 {
            color: #f39c12;
            text-align: center;
            padding-bottom: 10px;
            background: linear-gradient(135deg, #ffe5b4 0%, #ffd799 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .content {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 12px;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>âœ¨ ${type} âœ¨</h1>
    <div class="content">
        <pre>${content}</pre>
    </div>
    <div class="footer">
        ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString('zh-CN')}<br>
        æç¤º: æ•™å¸ˆå¯ç›´æ¥åœ¨æ­¤æ–‡æ¡£ä¸­ç¼–è¾‘å’Œä¿®æ”¹å†…å®¹
    </div>
</body>
</html>`;
            } else {
                // Uaroè¯¾ç¨‹é€šç”¨å¯çˆ±é£æ ¼æ¨¡æ¿
                wordContent = `
<html xmlns:o='urn:schemas-microsoft-com:office:office' 
      xmlns:w='urn:schemas-microsoft-com:office:word' 
      xmlns='http://www.w3.org/TR/REC-html40'>
<head>
    <meta charset='utf-8'>
    <title>${type}</title>
    <!--[if gte mso 9]>
    <xml>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>100</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            margin: 40px;
            background: #fafafa;
        }
        h1 {
            color: #673ab7;
            text-align: center;
            padding-bottom: 10px;
            background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .content {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 12px;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #d4fc79;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>âœ¨ ${type} âœ¨</h1>
    <div class="content">
        <pre>${content}</pre>
    </div>
    <div class="footer">
        ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString('zh-CN')}<br>
        æç¤º: æ•™å¸ˆå¯ç›´æ¥åœ¨æ­¤æ–‡æ¡£ä¸­ç¼–è¾‘å’Œä¿®æ”¹å†…å®¹
    </div>
</body>
</html>`;
            }

            // åˆ›å»ºBlobå¯¹è±¡
            const blob = new Blob([wordContent], {
                type: 'application/msword'
            });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${type}${fileExtension}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccess(`${type}å·²å¯¼å‡ºä¸ºWordæ–‡æ¡£ï¼`);
        }

        // ä¿å­˜æ‰€æœ‰ææ–™
        function saveAllMaterials() {
            // ä¿å­˜æ‰€æœ‰textareaä¸­çš„å†…å®¹åˆ°courseMaterialså¯¹è±¡
            const textareas = document.querySelectorAll('textarea[id^="textarea-"]');
            textareas.forEach(textarea => {
                const type = textarea.id.replace('textarea-', '').replace(/-/g, ' ');
                courseMaterials[type] = textarea.value;
            });
            
            showSuccess("æ‰€æœ‰ææ–™å·²ä¿å­˜ï¼");
        }

        // å¯¼å‡ºæ‰€æœ‰ææ–™
        function exportAllMaterials() {
            // å¯¼å‡ºæ‰€æœ‰ææ–™
            const materialEntries = Object.entries(courseMaterials);
            for (let i = 0; i < materialEntries.length; i++) {
                const [type, content] = materialEntries[i];
                
                // æ ¹æ®ææ–™ç±»å‹ç¡®å®šå¯¼å‡ºæ ¼å¼
                let isImageFormat = false;
                if (currentCourseType === 'kiro') {
                    isImageFormat = type.includes('ç”Ÿæˆå®¶é•¿å›¾ç‰‡') || type.includes('è®¾è®¡æ¿ä¹¦');
                } else if (currentCourseType === 'microcontroller') {
                    isImageFormat = type.includes('è¯¾å ‚å†…å®¹') || type.includes('è¯¾å ‚æ¿ä¹¦');
                } else if (currentCourseType === 'python') {
                    isImageFormat = type.includes('è¯¾å ‚å†…å®¹') || type.includes('è¯¾å ‚æ¿ä¹¦');
                } else {
                    isImageFormat = type.includes('è¯¾å‰é¢„çƒ­') || type.includes('æ¿ä¹¦è®¾è®¡');
                }
                
                if (isImageFormat) {
                    exportMaterialAsImage(type, content, '.png');
                } else {
                    exportMaterialAsWord(type, content, '.doc');
                }
            }
            
            showSuccess("æ‰€æœ‰ææ–™å·²å¼€å§‹å¯¼å‡ºï¼");
        }

        // ä¿å­˜å¹¶å¯¼å‡ºæ‰€æœ‰ææ–™
        function saveAndExportAllMaterials() {
            saveAllMaterials();
            exportAllMaterials();
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('course-theme').addEventListener('keypress', e => {
            if (e.key === 'Enter') generateCourseGoals();
        });
    </script>
</body>
</html>

